  - name: postgresql key
    apt_key:
      url: https://www.postgresql.org/media/keys/ACCC4CF8.asc
      state: present
    become: true
     
  - name: create variable
    command: bash -c "echo \"deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main\" "
    register: repo_line
 
  - debug: 
      msg: "{{ repo_line.stdout }}"
       
  - name: add postgresql repo 
    apt_repository:
      repo: "{{ repo_line.stdout }}"
      state: present
    become: true
 
  - name: install postgresql
    apt:
      name: "postgresql-{{postgresql_version}}"
      state: present
      update_cache: yes
    become: true

  - name: Utility present
    ansible.builtin.package:
        name: python3-psycopg2
        state: present
  
  - name: Create db
    community.postgresql.postgresql_db:
        state: present
        name: "{{ db_name }}"
    become: true
    become_user: postgres